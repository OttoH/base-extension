{"version":3,"file":"background.js","mappings":";;UAAA;UACA;;;;;WCDA;WACA;WACA;WACA;WACA,yCAAyC,wCAAwC;WACjF;WACA;WACA,E;;;;;WCPA,wF;;;;;WCAA;WACA;WACA;WACA,uDAAuD,iBAAiB;WACxE;WACA,gDAAgD,aAAa;WAC7D,E;;;;;;;;;;;;ACHA,MAAM,iBAAiB;IACrB;QACE,IAAI,CAAC,uBAAuB,EAAE,CAAC;QAC/B,IAAI,CAAC,iBAAiB,EAAE,CAAC;IAC3B,CAAC;IAEO,uBAAuB;QAC7B,gCAAgC;QAChC,MAAM,CAAC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC,OAAO,EAAE,EAAE;YACjD,IAAI,OAAO,CAAC,MAAM,KAAK,SAAS,EAAE,CAAC;gBACjC,IAAI,CAAC,kBAAkB,EAAE,CAAC;YAC5B,CAAC;iBAAM,IAAI,OAAO,CAAC,MAAM,KAAK,QAAQ,EAAE,CAAC;gBACvC,IAAI,CAAC,qBAAqB,CAAC,OAAO,CAAC,eAAe,CAAC,CAAC;YACtD,CAAC;QACH,CAAC,CAAC,CAAC;QAEH,iDAAiD;QACjD,MAAM,CAAC,OAAO,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,EAAE,EAAE;YACrE,IAAI,CAAC,aAAa,CAAC,OAAO,EAAE,MAAM,EAAE,YAAY,CAAC,CAAC;YAClD,OAAO,IAAI,CAAC,CAAC,gDAAgD;QAC/D,CAAC,CAAC,CAAC;QAEH,qBAAqB;QACrB,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,KAAK,EAAE,UAAU,EAAE,GAAG,EAAE,EAAE;YAC3D,IAAI,UAAU,CAAC,MAAM,KAAK,UAAU,IAAI,GAAG,CAAC,GAAG,EAAE,CAAC;gBAChD,IAAI,CAAC,iBAAiB,CAAC,KAAK,EAAE,GAAG,CAAC,CAAC;YACrC,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,iBAAiB;QACvB,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC;YACzB,EAAE,EAAE,iBAAiB;YACrB,KAAK,EAAE,kCAAkC;YACzC,QAAQ,EAAE,CAAC,MAAM,EAAE,WAAW,CAAC;SAChC,CAAC,CAAC;QAEH,MAAM,CAAC,YAAY,CAAC,SAAS,CAAC,WAAW,CAAC,CAAC,IAAI,EAAE,GAAG,EAAE,EAAE;YACtD,IAAI,IAAI,CAAC,UAAU,KAAK,iBAAiB,IAAI,GAAG,EAAE,EAAE,EAAE,CAAC;gBACrD,IAAI,CAAC,qBAAqB,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;YACrC,CAAC;QACH,CAAC,CAAC,CAAC;IACL,CAAC;IAEO,KAAK,CAAC,aAAa,CACzB,OAAY,EACZ,MAAoC,EACpC,YAAsC;QAEtC,IAAI,CAAC;YACH,QAAQ,OAAO,CAAC,MAAM,EAAE,CAAC;gBACvB,KAAK,gBAAgB;oBACnB,IAAI,MAAM,CAAC,GAAG,EAAE,EAAE,EAAE,CAAC;wBACnB,MAAM,IAAI,GAAG,MAAM,IAAI,CAAC,qBAAqB,CAAC,MAAM,CAAC,GAAG,CAAC,EAAE,CAAC,CAAC;wBAC7D,YAAY,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,CAAC,CAAC;oBACxC,CAAC;yBAAM,CAAC;wBACN,YAAY,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,qBAAqB,EAAE,CAAC,CAAC;oBACjE,CAAC;oBACD,MAAM;gBAER,KAAK,gBAAgB;oBACnB,IAAI,CAAC,mBAAmB,CAAC,OAAO,CAAC,GAAG,EAAE,MAAM,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;oBACtD,YAAY,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;oBAChC,MAAM;gBAER,KAAK,eAAe;oBAClB,MAAM,UAAU,GAAG,MAAM,IAAI,CAAC,aAAa,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;oBAC3D,YAAY,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,CAAC;oBAClD,MAAM;gBAER,KAAK,iBAAiB;oBACpB,MAAM,IAAI,CAAC,eAAe,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC;oBAC1C,YAAY,CAAC,EAAE,OAAO,EAAE,IAAI,EAAE,CAAC,CAAC;oBAChC,MAAM;gBAER;oBACE,YAAY,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,gBAAgB,EAAE,CAAC,CAAC;YAC9D,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,0BAA0B,EAAE,KAAK,CAAC,CAAC;YACjD,YAAY,CAAC,EAAE,OAAO,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,YAAY,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,eAAe,EAAE,CAAC,CAAC;QACpG,CAAC;IACH,CAAC;IAEO,KAAK,CAAC,qBAAqB,CAAC,KAAa;QAC/C,IAAI,CAAC;YACH,MAAM,OAAO,GAAG,MAAM,MAAM,CAAC,SAAS,CAAC,aAAa,CAAC;gBACnD,MAAM,EAAE,EAAE,KAAK,EAAE;gBACjB,IAAI,EAAE,GAAG,EAAE;oBACT,yCAAyC;oBACzC,MAAM,SAAS,GAAI,MAAc,CAAC,gBAAgB,CAAC;oBACnD,IAAI,SAAS,IAAI,OAAO,SAAS,CAAC,kBAAkB,KAAK,UAAU,EAAE,CAAC;wBACpE,OAAO,SAAS,CAAC,kBAAkB,EAAE,CAAC;oBACxC,CAAC;oBAED,sDAAsD;oBACtD,OAAO;wBACL,GAAG,EAAE,MAAM,CAAC,QAAQ,CAAC,IAAI;wBACzB,KAAK,EAAE,QAAQ,CAAC,KAAK;wBACrB,QAAQ,EAAE,EAAE;wBACZ,iBAAiB,EAAE,EAAE;wBACrB,QAAQ,EAAE,EAAE;wBACZ,WAAW,EAAE,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE;qBACtC,CAAC;gBACJ,CAAC;aACF,CAAC,CAAC;YAEH,IAAI,OAAO,CAAC,CAAC,CAAC,EAAE,MAAM,EAAE,CAAC;gBACvB,MAAM,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,MAAuB,CAAC;gBAChD,MAAM,IAAI,CAAC,kBAAkB,CAAC,KAAK,EAAE,IAAI,CAAC,CAAC;gBAC3C,OAAO,IAAI,CAAC;YACd,CAAC;QACH,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,4BAA4B,EAAE,KAAK,CAAC,CAAC;QACrD,CAAC;QAED,OAAO,IAAI,CAAC;IACd,CAAC;IAEO,KAAK,CAAC,kBAAkB,CAAC,KAAa,EAAE,IAAmB;QACjE,MAAM,GAAG,GAAG,kBAAkB,KAAK,EAAE,CAAC;QACtC,MAAM,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,IAAI,EAAE,CAAC,CAAC;QAEhD,yCAAyC;QACzC,MAAM,MAAM,CAAC,OAAO,CAAC,OAAO,CAAC,GAAG,CAAC;YAC/B,cAAc,EAAE,IAAI;YACpB,mBAAmB,EAAE,KAAK;SAC3B,CAAC,CAAC;IACL,CAAC;IAEO,KAAK,CAAC,aAAa,CAAC,KAAa;QACvC,MAAM,GAAG,GAAG,kBAAkB,KAAK,EAAE,CAAC;QACtC,MAAM,MAAM,GAAG,MAAM,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;QACrD,OAAO,MAAM,CAAC,GAAG,CAAC,IAAI,IAAI,CAAC;IAC7B,CAAC;IAEO,KAAK,CAAC,eAAe,CAAC,KAAa;QACzC,MAAM,GAAG,GAAG,kBAAkB,KAAK,EAAE,CAAC;QACtC,MAAM,MAAM,CAAC,OAAO,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IAC3C,CAAC;IAEO,kBAAkB;QACxB,uBAAuB;QACvB,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC;YACtB,WAAW,EAAE,KAAK;YAClB,WAAW,EAAE;gBACX,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,YAAY,EAAE,KAAK;aACnD;YACD,gBAAgB,EAAE,EAAE;YACpB,UAAU,EAAE,EAAE;SACf,CAAC,CAAC;QAEH,oBAAoB;QACpB,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC;YACjB,GAAG,EAAE,MAAM,CAAC,OAAO,CAAC,MAAM,CAAC,cAAc,CAAC;SAC3C,CAAC,CAAC;IACL,CAAC;IAEO,qBAAqB,CAAC,eAAwB;QACpD,OAAO,CAAC,GAAG,CAAC,kCAAkC,eAAe,OAAO,MAAM,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC,OAAO,EAAE,CAAC,CAAC;QAE5G,6BAA6B;QAC7B,IAAI,eAAe,IAAI,IAAI,CAAC,cAAc,CAAC,eAAe,CAAC,EAAE,CAAC;YAC5D,IAAI,CAAC,WAAW,CAAC,eAAe,CAAC,CAAC;QACpC,CAAC;IACH,CAAC;IAEO,cAAc,CAAC,eAAuB;QAC5C,oCAAoC;QACpC,OAAO,KAAK,CAAC;IACf,CAAC;IAEO,KAAK,CAAC,WAAW,CAAC,eAAuB;QAC/C,gCAAgC;QAChC,OAAO,CAAC,GAAG,CAAC,8BAA8B,EAAE,eAAe,CAAC,CAAC;IAC/D,CAAC;IAEO,iBAAiB,CAAC,KAAa,EAAE,GAAoB;QAC3D,yCAAyC;QACzC,IAAI,GAAG,CAAC,GAAG,IAAI,IAAI,CAAC,eAAe,CAAC,GAAG,CAAC,GAAG,CAAC,EAAE,CAAC;YAC7C,wDAAwD;YACxD,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,aAAa,CAAC,EAAE,CAAC,MAAM,EAAE,EAAE;gBAClD,IAAI,MAAM,CAAC,WAAW,EAAE,CAAC;oBACvB,IAAI,CAAC,qBAAqB,CAAC,KAAK,CAAC,CAAC;gBACpC,CAAC;YACH,CAAC,CAAC,CAAC;QACL,CAAC;IACH,CAAC;IAEO,eAAe,CAAC,GAAW;QACjC,MAAM,UAAU,GAAG;YACjB,WAAW,EAAE,SAAS,EAAE,WAAW,EAAE,WAAW,EAAE,cAAc;YAChE,WAAW,EAAE,eAAe,EAAE,eAAe,EAAE,WAAW;SAC3D,CAAC;QAEF,MAAM,WAAW,GAAG;YAClB,YAAY,EAAE,QAAQ,EAAE,KAAK,EAAE,KAAK,EAAE,KAAK,EAAE,OAAO,EAAE,QAAQ;SAC/D,CAAC;QAEF,OAAO,UAAU,CAAC,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,GAAG,CAAC,QAAQ,CAAC,MAAM,CAAC,CAAC;YAC/C,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,CAAC;IAC1E,CAAC;IAEO,mBAAmB,CAAC,GAAW,EAAE,KAAc;QACrD,iCAAiC;QACjC,IAAI,KAAK,EAAE,CAAC;YACV,yBAAyB;YACzB,YAAY,CAAE,IAAY,CAAC,sBAAsB,KAAK,EAAE,CAAC,CAAC,CAAC;YAC1D,IAAY,CAAC,sBAAsB,KAAK,EAAE,CAAC,GAAG,UAAU,CAAC,GAAG,EAAE;gBAC7D,OAAO,CAAC,GAAG,CAAC,yBAAyB,EAAE,KAAK,CAAC,CAAC;gBAC9C,gCAAgC;YAClC,CAAC,EAAE,IAAI,CAAC,CAAC;QACX,CAAC;IACH,CAAC;CACF;AAED,gCAAgC;AAChC,IAAI,iBAAiB,EAAE,CAAC;AAExB,iEAAe,iBAAiB,EAAC","sources":["webpack://workspace/webpack/bootstrap","webpack://workspace/webpack/runtime/define property getters","webpack://workspace/webpack/runtime/hasOwnProperty shorthand","webpack://workspace/webpack/runtime/make namespace object","webpack://workspace/./src/background.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// Background service worker for the extension\nimport { ExtractedData } from './types';\n\nclass BackgroundService {\n  constructor() {\n    this.setupExtensionListeners();\n    this.setupContextMenus();\n  }\n\n  private setupExtensionListeners(): void {\n    // Handle extension installation\n    chrome.runtime.onInstalled.addListener((details) => {\n      if (details.reason === 'install') {\n        this.handleFirstInstall();\n      } else if (details.reason === 'update') {\n        this.handleExtensionUpdate(details.previousVersion);\n      }\n    });\n\n    // Handle messages from content scripts and popup\n    chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {\n      this.handleMessage(request, sender, sendResponse);\n      return true; // Keep message channel open for async responses\n    });\n\n    // Handle tab updates\n    chrome.tabs.onUpdated.addListener((tabId, changeInfo, tab) => {\n      if (changeInfo.status === 'complete' && tab.url) {\n        this.handleTabComplete(tabId, tab);\n      }\n    });\n  }\n\n  private setupContextMenus(): void {\n    chrome.contextMenus.create({\n      id: 'soulvet-extract',\n      title: 'Extract pet content with SOULVET',\n      contexts: ['page', 'selection']\n    });\n\n    chrome.contextMenus.onClicked.addListener((info, tab) => {\n      if (info.menuItemId === 'soulvet-extract' && tab?.id) {\n        this.extractContentFromTab(tab.id);\n      }\n    });\n  }\n\n  private async handleMessage(\n    request: any, \n    sender: chrome.runtime.MessageSender, \n    sendResponse: (response?: any) => void\n  ): Promise<void> {\n    try {\n      switch (request.action) {\n        case 'extractContent':\n          if (sender.tab?.id) {\n            const data = await this.extractContentFromTab(sender.tab.id);\n            sendResponse({ success: true, data });\n          } else {\n            sendResponse({ success: false, error: 'No tab ID available' });\n          }\n          break;\n\n        case 'contentChanged':\n          this.handleContentChange(request.url, sender.tab?.id);\n          sendResponse({ success: true });\n          break;\n\n        case 'getStoredData':\n          const storedData = await this.getStoredData(request.tabId);\n          sendResponse({ success: true, data: storedData });\n          break;\n\n        case 'clearStoredData':\n          await this.clearStoredData(request.tabId);\n          sendResponse({ success: true });\n          break;\n\n        default:\n          sendResponse({ success: false, error: 'Unknown action' });\n      }\n    } catch (error) {\n      console.error('Background script error:', error);\n      sendResponse({ success: false, error: error instanceof Error ? error.message : 'Unknown error' });\n    }\n  }\n\n  private async extractContentFromTab(tabId: number): Promise<ExtractedData | null> {\n    try {\n      const results = await chrome.scripting.executeScript({\n        target: { tabId },\n        func: () => {\n          // This function runs in the page context\n          const extractor = (window as any).contentExtractor;\n          if (extractor && typeof extractor.extractPageContent === 'function') {\n            return extractor.extractPageContent();\n          }\n          \n          // Fallback extraction if content script not available\n          return {\n            url: window.location.href,\n            title: document.title,\n            headings: [],\n            petRelatedContent: [],\n            metadata: {},\n            extractedAt: new Date().toISOString()\n          };\n        }\n      });\n\n      if (results[0]?.result) {\n        const data = results[0].result as ExtractedData;\n        await this.storeExtractedData(tabId, data);\n        return data;\n      }\n    } catch (error) {\n      console.error('Failed to extract content:', error);\n    }\n    \n    return null;\n  }\n\n  private async storeExtractedData(tabId: number, data: ExtractedData): Promise<void> {\n    const key = `extracted_data_${tabId}`;\n    await chrome.storage.local.set({ [key]: data });\n    \n    // Also store in session for quick access\n    await chrome.storage.session.set({ \n      lastExtraction: data,\n      lastExtractionTabId: tabId \n    });\n  }\n\n  private async getStoredData(tabId: number): Promise<ExtractedData | null> {\n    const key = `extracted_data_${tabId}`;\n    const result = await chrome.storage.local.get([key]);\n    return result[key] || null;\n  }\n\n  private async clearStoredData(tabId: number): Promise<void> {\n    const key = `extracted_data_${tabId}`;\n    await chrome.storage.local.remove([key]);\n  }\n\n  private handleFirstInstall(): void {\n    // Set default settings\n    chrome.storage.sync.set({\n      autoExtract: false,\n      petKeywords: [\n        'dog', 'cat', 'pet', 'animal', 'veterinary', 'vet'\n      ],\n      minContentLength: 30,\n      maxResults: 15\n    });\n\n    // Open welcome page\n    chrome.tabs.create({\n      url: chrome.runtime.getURL('welcome.html')\n    });\n  }\n\n  private handleExtensionUpdate(previousVersion?: string): void {\n    console.log(`SOULVET Extension updated from ${previousVersion} to ${chrome.runtime.getManifest().version}`);\n    \n    // Handle migration if needed\n    if (previousVersion && this.needsMigration(previousVersion)) {\n      this.migrateData(previousVersion);\n    }\n  }\n\n  private needsMigration(previousVersion: string): boolean {\n    // Add version comparison logic here\n    return false;\n  }\n\n  private async migrateData(previousVersion: string): Promise<void> {\n    // Add data migration logic here\n    console.log('Migrating data from version:', previousVersion);\n  }\n\n  private handleTabComplete(tabId: number, tab: chrome.tabs.Tab): void {\n    // Check if this is a pet-related website\n    if (tab.url && this.isPetRelatedUrl(tab.url)) {\n      // Optionally auto-extract content for pet-related sites\n      chrome.storage.sync.get(['autoExtract'], (result) => {\n        if (result.autoExtract) {\n          this.extractContentFromTab(tabId);\n        }\n      });\n    }\n  }\n\n  private isPetRelatedUrl(url: string): boolean {\n    const petDomains = [\n      'petmd.com', 'akc.org', 'aspca.org', 'petco.com', 'petsmart.com',\n      'chewy.com', 'vetstreet.com', 'petfinder.com', 'rover.com'\n    ];\n    \n    const petKeywords = [\n      'veterinary', 'animal', 'pet', 'dog', 'cat', 'puppy', 'kitten'\n    ];\n\n    return petDomains.some(domain => url.includes(domain)) ||\n           petKeywords.some(keyword => url.toLowerCase().includes(keyword));\n  }\n\n  private handleContentChange(url: string, tabId?: number): void {\n    // Handle dynamic content changes\n    if (tabId) {\n      // Debounce rapid changes\n      clearTimeout((this as any)[`contentChangeTimer_${tabId}`]);\n      (this as any)[`contentChangeTimer_${tabId}`] = setTimeout(() => {\n        console.log('Content changed on tab:', tabId);\n        // Optionally re-extract content\n      }, 2000);\n    }\n  }\n}\n\n// Initialize background service\nnew BackgroundService();\n\nexport default BackgroundService;\n"],"names":[],"sourceRoot":""}